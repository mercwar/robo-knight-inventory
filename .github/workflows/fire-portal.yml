name: FIRE-CYHY-MERC-G-PORTAL-FAST

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  portal-orchestration:
    runs-on: ubuntu-latest
    container: debian:bookworm-slim # Slim version for speed
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Initialize fire-portal.log
        run: |
          echo "[$(date)] SYSTEM: Repo Pulled. Fast-Boot Active." > fire-portal.log

      - name: Install Essential Toolchain Only
        run: |
          apt-get update && apt-get install -y \
            nasm binutils gcc git jq python3 python3-pip --no-install-recommends
          python3 -m pip install torch tensorflow opencv-python --break-system-packages --no-cache-dir

      - name: Compile and Run Master Dispatcher
        run: |
          echo "[$(date)] JOB: Compiling Master Suite" >> fire-portal.log
          # Pre-compile the external tools
          nasm -f elf64 fire-log.asm -o fire-log.o && ld fire-log.o -o fire-log_bin
          nasm -f elf64 fire-end.asm -o fire-end.o && ld fire-end.o -o fire-end_bin
          # Compile and execute the Brain
          nasm -f elf64 fire-gem.asm -o fire-gem.o && ld fire-gem.o -o fire-gem_bin
          ./fire-gem_bin >> fire-portal.log 2>&1
