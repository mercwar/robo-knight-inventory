name: CVBGODS FIRE PORTAL
on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Create Directory and File
        run: |
          CURRENT_TIME=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
          echo "CVBGOD PORTAL ENTRY FOR ROBOTS: $CURRENT_TIME" > ROBOT.CVBGOD

      - name: AI Read and Generate Third Test
        run: |
          cat ROBOT.CVBGOD
          CURRENT_TIME=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
          echo "CVBGOD PORTAL ENTRY FOR AVIS TIME IS: $CURRENT_TIME" > CVBGOD.AVIS
      
      - name: CHMOD COMPILE AND RUN FIRE-GEM
        run: |
          # Install NASM
          sudo apt-get update && sudo apt-get install -y nasm
          
          echo "--- COMPILATION LOG START ---" > compile.log
          
          # Assemble and Link with logging
          echo "[LOG] Assembling fire-gem.asm..." >> compile.log
          nasm -f elf64 fire-gem.asm -o fire-gem.o 2>> compile.log
          
          echo "[LOG] Linking fire-gem..." >> compile.log
          ld fire-gem.o -o fire-gem 2>> compile.log
          
          echo "[LOG] Executing FIRE-GEM..." >> compile.log
          chmod +x fire-gem
          ./fire-gem >> compile.log 2>&1
          
          # Output log to console for immediate robot feedback
          cat compile.log

      - name: SAVE CODESPACE TO DISK
        run: | 
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Automated: CVBGOD portal sequence & compile logs"
          git push
